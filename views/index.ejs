<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('/metadata', { title: 'Homepage' }) %>
</head>

<body>
  <%- include('/nav', { authenticated }) %>

  <hgroup>
    <h1>FlashX</h1>
    <p>Learn with flashcards!</p>
  </hgroup>

  <ul>
    <li>Build your own flashcard collections.</li>
    <li>Start memorizing with a FlashX training session.</li>
  </ul>

  <% if (!authenticated) { %>

  <% for (const { message } of flash) { %>
  <p><%= message %></p>
  <% } %>
  <script>
    const swapForms = () => {
      const login = document.getElementById('login');
      const register = document.getElementById('register');

      login.hidden = !login.hidden;
      register.hidden = !register.hidden;
    };
  </script>
  <form action="/login" method="post" id="login">
    <label>Username
      <input name="username" autocomplete="username" required autofocus>
    </label>
    <label>Password
      <input name="password" autocomplete="current-password" required>
    </label>
    <button>Log in</button>
    <p>No account?
      <button type="button" onclick="swapForms()">Register</button>
    </p>
  </form>

  <form action="/register" method="post" id="register" hidden>
    <label>Username
      <input name="username" id="username" autocomplete="username" required
          maxlength="128" pattern="[!-~]*">
    </label>
    <script type="module">
      const username = document.getElementById('username');

      username.addEventListener('input', event => {
        const validity = username.validity;
        const message =
          validity.tooLong ? 'Maximum length is 128' :
            validity.patternMismatch ? `Forbidden:
            spaces
            control characters
            non-ascii characters` : '';

        username.setCustomValidity(message);
      });
    </script>
    <label>Password
      <input name="password" id="password" autocomplete="new-password"
          minlength="11"
          pattern="(?=.*?\d)(?=.*?[a-z])(?=.*?[A-Z])(?=.*?[!-/:-@[-`{-~])[!-~]*"
          maxlength="128" required>
    </label>
    <script type="module">
      const password = document.getElementById('password');

      password.addEventListener('input', event => {
        const validity = password.validity;
        const message =
          validity.tooShort ? 'Minimum length is 11' :
            validity.tooLong ? 'Maximum length is 128' :
              validity.patternMismatch ? `Required:
    1 small letter
    1 capital letter
    1 digit
    1 symbol
    
    Forbidden:
    spaces
    control characters
    non-ascii characters` : '';

        password.setCustomValidity(message);
      });
    </script>
    <button>Sign up</button>
    <p>Already registered?
      <button type="button" onclick="swapForms()">Log in</button>
    </p>
  </form>

  <% } %>

</body>

</html>
