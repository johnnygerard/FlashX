<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('/metadata', { title: 'Flashcard hub' }) %>
  <%- include('/addClickListener') %>
  <base href="/collections/">
  <style>
    #createFSet {
      width: fit-content;
      padding: 1em;
      background-color: lightgray;
      border-radius: 0.5em;
    }

    #createFSet>button {
      background-color: #0A0;
      color: var(--accent-secondary);
      margin-left: 1em;
      cursor: pointer;
    }

    #createFSet>label {
      display: block;
      margin-bottom: 0.5em;
    }

    #createFSet>input,
    #createFSet>button {
      border-radius: 0.5em;
      padding: 1em;
      border: none;
    }

    #createFSet>input {
      all: unset;
      background-color: var(--accent-secondary);
      padding: 1em;
      border-radius: 0.5em;
    }

    #createFSet>input:focus {
      background-color: white;
    }

  </style>
</head>

<body>
  <%- include('/nav', { authenticated }) %>

  <main>
    <%- include('/logo') %>
    <h2>Welcome <%= user %>!</h2>
    <div id="createFSet">
      <label for="name">Name</label>
      <input id="name" required autofocus maxlength="256" name="name" size="16">
      <button type="button">Add collection</button>
    </div>
    <script type="module">
      const button = document.querySelector('#createFSet>button');
      const name = document.getElementById('name');

      addClickListener(button, 'fset', 'POST', {}, name);
    </script>
    <% if (fsets.length) { %>
    <ul id="fsets">
      <% fsets.forEach((fset, index) => { %>
      <li><a href="<%= index %>"><%= fset %></a></li>
      <% }); %>
    </ul>
    <template id="delete"><button type="button">Delete</button></template>
    <template id="rename">
      <input required maxlength="256" name="name">
      <button type="button">Rename</button>
    </template>
    <script type="module">
      const deleteFragment = document.getElementById('delete').content;
      const deleteButton = deleteFragment.firstElementChild;

      const renameFragment = document.getElementById('rename').content;
      const renameButton = renameFragment.querySelector('button');
      const nameInput = renameFragment.querySelector('input');

      const listItems = document.getElementById('fsets').children;

      Array.prototype.forEach.call(listItems, (li, index) => {
        const deleteButtonClone = deleteButton.cloneNode(true);
        const renameButtonClone = renameButton.cloneNode(true);
        const nameInputClone = nameInput.cloneNode(true);

        addClickListener(deleteButtonClone, 'fset', 'DELETE', { index });
        addClickListener(renameButtonClone, 'fset', 'PATCH', { index },
          nameInputClone);

        li.appendChild(nameInputClone);
        li.appendChild(renameButtonClone);
        li.appendChild(deleteButtonClone);
      });
    </script>
    <% } %>
  </main>

</body>

</html>
